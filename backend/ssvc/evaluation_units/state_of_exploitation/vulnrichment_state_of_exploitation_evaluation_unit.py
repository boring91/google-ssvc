from typing import Optional, Literal

from app.data_sources.cisa_vulnrichment_cve_data_source import CisaVulnrichmentCveDataSource
from ssvc.evaluation_units.evaluation_unit import EvaluationResult
from ssvc.evaluation_units.state_of_exploitation.base_state_of_exploitation_evaluation_unit import \
    BaseStateOfExploitationEvaluationUnit


class VulnrichmentStateOfExploitationEvaluationUnit(BaseStateOfExploitationEvaluationUnit):
    def _process_evaluation(self, cve_id: str) -> Optional[EvaluationResult[Literal['active', 'poc', 'none']]]:
        data_source = CisaVulnrichmentCveDataSource()

        result = data_source.load(cve_id)
        if result is None:
            return None

        return EvaluationResult(result['exploitation'], 1, 'Found in the CISA Vulnrichment data set.')
