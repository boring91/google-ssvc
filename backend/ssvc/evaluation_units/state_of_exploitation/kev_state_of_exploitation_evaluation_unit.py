from typing import Optional

from app.data_sources.cisa_kev_cve_data_source import CisaKevCveDataSource
from ssvc.evaluation_units.evaluation_unit import EvaluationResult
from ssvc.evaluation_units.state_of_exploitation.base_state_of_exploitation_evaluation_unit import \
    BaseStateOfExploitationEvaluationUnit


class KevStateOfExploitationEvaluationUnit(BaseStateOfExploitationEvaluationUnit):
    def __init__(self):
        self._kev_data_source = CisaKevCveDataSource()

    def _process_evaluation(self, cve_id: str, reevaluate: bool) -> Optional[EvaluationResult]:
        result = self._kev_data_source.load(cve_id, reevaluate)
        if result is not None:
            return EvaluationResult('active', 1, 'Found in the CISA KEV dataset.', [])

        return None
