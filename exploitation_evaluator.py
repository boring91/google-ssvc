from base_evaluator import BaseEvaluator


class ExploitationEvaluator(BaseEvaluator):

    def _get_prompt(self, cve_id: str, cve_data: str) -> str:
        return f"""I will give you two pieces of information; a CVE ID and a json string containing 
                   information about the CVE. In the json string, each object at the root level is data from 
                   a specific data source. For example, If we have two properties at the root level of the json object, 
                   then it means we are looking at two pieces of data from two different data sources. Your role is to 
                   determine the "State of Exploitation" for the given CVE ID. You should only answer with one of the 
                   following: "none", "poc", or "active". Here is the methodology you should follow to determine how 
                   to categorize a CVE into one of these answers:
                       "none": No Evidence of the active exploitation found.
                       "poc": To choose this value, one of the following criteria must be met:
                           1. Private proofs of exploitation have been detected, which have yet to be shared publicly.
                           2. There are rumours in the cybersecurity community about the exploitation of this 
                              vulnerability.
                           3. Proofs of concept have been found in spaces such as Metasploit.
                           4. The methodology for exploiting the vulnerability is known.
                       "active": Reliable and confirmed evidence of real exploitation of the vulnerability by attackers
                        has been collected and is publicly reported. Do NOT report a CVE as active unless it has been
                        used by attackers. If a CVE has been reported to have a publicly available 
                        proof of concept (poc) that may lead to a potential exploitation, do not evaluate it as 
                        "active" as it should be "poc" in this case. If there are indications that the CVE may have been
                        used without any hard evidence, do not evaluate it as "active", it should be "poc".
                        
                   You answer should be formatted as a json object with two properties:
                   1) "cve_id" which contains the id of the cve in question, 2) "assessment" which can take one 
                   of the three previous values, 3) "justification": explaining how you reached to the answer 
                   you provided in the "assessment" property (the description should not refer to the json data 
                   but rather talks about the information that led you to this conclusion, aka, avoid saying
                   the json data shows etc. Also avoid giving generic descriptions like: "multiple sources
                   have reported etc." but rather provide concrete descriptions: e.g., name the sources, 
                   name the versions or software, provide links if available, etc.), and 
                   4) "confidence": ranges between 0 and 1, which indicates
                   how confident you are in your assessment, 1 being very confident.

                   You should only respond with the json object nothing more.

                   Here are the two pieces of information:

                   CVE ID: {cve_id}
                   JSON data: {cve_data}
                """
